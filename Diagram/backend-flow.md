# PhantomWall Backend Flow

## ğŸ”„ Backend Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BACKEND ARCHITECTURE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React App          â”‚
â”‚   (Frontend)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTP Request
           â”‚ GET /events?date=2026-01-15
           â”‚ POST /chat {"query": "top attackers"}
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸšª API GATEWAY (Entry Point)                                               â”‚
â”‚                                                                              â”‚
â”‚  Routes:                                                                     â”‚
â”‚  â”œâ”€ GET  /events    â†’ Suricata API Lambda                                   â”‚
â”‚  â”œâ”€ POST /chat      â†’ Chat Assistant Lambda                                 â”‚
â”‚  â””â”€ GET  /alerts    â†’ Alert API Lambda                                      â”‚
â”‚                                                                              â”‚
â”‚  Features: CORS, Rate Limiting, Request Validation, Access Logs             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚
             â”‚                      â”‚
             â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš¡ Suricata API      â”‚  â”‚  âš¡ Chat Assistant Lambda                    â”‚
â”‚     Lambda            â”‚  â”‚                                              â”‚
â”‚                       â”‚  â”‚  Steps:                                      â”‚
â”‚  Steps:               â”‚  â”‚  1. Receive user question                    â”‚
â”‚  1. Parse request     â”‚  â”‚  2. Query DynamoDB for context               â”‚
â”‚  2. Build DDB query   â”‚  â”‚     â””â”€â†’ Get recent attack events             â”‚
â”‚  3. Execute query     â”‚  â”‚  3. Build prompt with context                â”‚
â”‚  4. Format response   â”‚  â”‚  4. Call Bedrock AI                          â”‚
â”‚  5. Return JSON       â”‚  â”‚     â””â”€â†’ InvokeModel API                      â”‚
â”‚                       â”‚  â”‚  5. Return AI analysis                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚                â”‚
            â”‚ Query                  â”‚ Query          â”‚ InvokeModel
            â–¼                        â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¾ DynamoDB            â”‚  â”‚  ğŸ’¾ DynamoDB    â”‚  â”‚  ğŸ¤– AWS Bedrock  â”‚
â”‚  Suricata Events        â”‚  â”‚  Suricata       â”‚  â”‚                  â”‚
â”‚                         â”‚  â”‚  Events         â”‚  â”‚  LLM Model       â”‚
â”‚  Query:                 â”‚  â”‚                 â”‚  â”‚  (e.g., Claude)  â”‚
â”‚  â€¢ PK = event_date      â”‚  â”‚  Returns:       â”‚  â”‚                  â”‚
â”‚  â€¢ Filter conditions    â”‚  â”‚  â€¢ Last 100     â”‚  â”‚  Analyzes:       â”‚
â”‚                         â”‚  â”‚    events       â”‚  â”‚  â€¢ Attack        â”‚
â”‚  Returns:               â”‚  â”‚  â€¢ Top IPs      â”‚  â”‚    patterns      â”‚
â”‚  â€¢ Alert events         â”‚  â”‚  â€¢ Signatures   â”‚  â”‚  â€¢ Threat level  â”‚
â”‚  â€¢ Attack metadata      â”‚  â”‚                 â”‚  â”‚  â€¢ Recommend-    â”‚
â”‚  â€¢ Timestamps           â”‚  â”‚                 â”‚  â”‚    ations        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â”‚ Results                â”‚ AI Response
            â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¤ API Response      â”‚  â”‚  ğŸ“¤ API Response                             â”‚
â”‚                       â”‚  â”‚                                              â”‚
â”‚  {                    â”‚  â”‚  {                                           â”‚
â”‚    "events": [...],   â”‚  â”‚    "response": "Top 5 attackers are...",    â”‚
â”‚    "total": 150,      â”‚  â”‚    "context": {...}                         â”‚
â”‚    "page": 1          â”‚  â”‚  }                                           â”‚
â”‚  }                    â”‚  â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  React App   â”‚
                   â”‚  Renders UI  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”„ PARALLEL FLOW: Data Ingestion (Background Process)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ Honeypot EC2   â”‚
â”‚                    â”‚
â”‚  Suricata IDS      â”‚
â”‚  detects attack    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Writes eve.json
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜ï¸ CloudWatch Logs                  â”‚
â”‚  /honeypot/suricata                   â”‚
â”‚                                       â”‚
â”‚  Log Entry:                           â”‚
â”‚  {"timestamp": "...",                 â”‚
â”‚   "alert": {"signature": "..."},      â”‚
â”‚   "src_ip": "1.2.3.4"}               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Subscription Filter
               â”‚ (triggers on new logs)
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš¡ Suricata Ingest Lambda            â”‚
â”‚                                        â”‚
â”‚  Steps:                                â”‚
â”‚  1. Receive log batch from CW          â”‚
â”‚  2. Decode & decompress                â”‚
â”‚  3. Parse JSON events                  â”‚
â”‚  4. Transform for DynamoDB             â”‚
â”‚     â€¢ Add PK (event_date)              â”‚
â”‚     â€¢ Add SK (event_id)                â”‚
â”‚     â€¢ Extract fields                   â”‚
â”‚  5. Batch write to DynamoDB            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ BatchWriteItem
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¾ DynamoDB - Suricata Events        â”‚
â”‚                                        â”‚
â”‚  New Record:                           â”‚
â”‚  {                                     â”‚
â”‚    "event_date": "2026-01-15",        â”‚
â”‚    "event_id": "uuid-...",            â”‚
â”‚    "src_ip": "1.2.3.4",               â”‚
â”‚    "signature": "ET SCAN ...",        â”‚
â”‚    "timestamp": "..."                  â”‚
â”‚  }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Now available for queries
               â–¼
         [Data ready for API]


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”„ ALERT INDEXING FLOW (Fast Lookups)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜ï¸ CloudWatch Logs               â”‚
â”‚  /honeypot/suricata               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Subscription Filter
               â”‚ (alerts only - severity > 2)
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš¡ Alert Indexer Lambda              â”‚
â”‚                                        â”‚
â”‚  Steps:                                â”‚
â”‚  1. Filter high-priority alerts        â”‚
â”‚  2. Extract key fields:                â”‚
â”‚     â€¢ Source IP                        â”‚
â”‚     â€¢ Signature ID                     â”‚
â”‚     â€¢ Severity                         â”‚
â”‚  3. Build indexes for fast queries     â”‚
â”‚  4. Set TTL (30 days)                  â”‚
â”‚  5. Write to Alerts Table              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ PutItem
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¾ DynamoDB - PhantomWall Alerts     â”‚
â”‚                                        â”‚
â”‚  Features:                             â”‚
â”‚  â€¢ PK/SK design for fast access        â”‚
â”‚  â€¢ GSI: src_ip-index  (10-50ms)       â”‚
â”‚  â€¢ GSI: signature-index (10-50ms)     â”‚
â”‚  â€¢ TTL: auto-delete after 30 days     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Queried by Alert API
               â–¼
         [Fast alert lookups]
```

## ğŸ“Š Request/Response Example

### Example 1: Get Events
```
REQUEST:
GET /events?date=2026-01-15&limit=50

â†“ API Gateway routes to Lambda

LAMBDA LOGIC:
1. Validate parameters
2. Query DynamoDB:
   - PK = "2026-01-15"
   - Limit = 50
   - ScanIndexForward = false (newest first)
3. Transform results
4. Return response

RESPONSE:
{
  "events": [
    {
      "event_id": "abc123",
      "timestamp": "2026-01-15T10:30:45Z",
      "src_ip": "1.2.3.4",
      "dest_ip": "10.0.1.5",
      "signature": "ET SCAN SSH Brute Force",
      "severity": 3
    },
    ...
  ],
  "total": 150,
  "next_token": "..."
}
```

### Example 2: AI Chat
```
REQUEST:
POST /chat
{
  "query": "What are the top 5 attacking IPs today?"
}

â†“ API Gateway routes to Chat Lambda

LAMBDA LOGIC:
1. Query DynamoDB for today's events
2. Aggregate top IPs
3. Build Bedrock prompt:
   "Based on these events: [...], answer: What are the top 5 attacking IPs?"
4. Call Bedrock InvokeModel
5. Return AI response

RESPONSE:
{
  "response": "Based on today's data, the top 5 attacking IPs are:
   1. 1.2.3.4 (45 attempts) - SSH brute force from Russia
   2. 5.6.7.8 (32 attempts) - Web scanning from China
   3. ...",
  "sources": ["event1", "event2", ...],
  "timestamp": "2026-01-15T10:35:00Z"
}
```

## âš¡ Performance Metrics

| Operation | Latency |
|-----------|---------|
| API Gateway â†’ Lambda | 5-20ms |
| Lambda â†’ DynamoDB query | 10-50ms |
| Lambda â†’ Bedrock AI | 500-2000ms |
| Total API response (events) | 50-200ms |
| Total API response (chat) | 1-3 seconds |
